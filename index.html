<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mine Muncher">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1a0a1a">
  <title>Mine Muncher</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
    html,body,#root{width:100%;height:100%;overflow:hidden;touch-action:manipulation}
    body{font-family:monospace;background:linear-gradient(180deg,#1a0a1a 0%,#2d1a2d 50%,#0d0d0d 100%)}
    @font-face{font-family:'Press Start 2P';src:url('https://fonts.gstatic.com/s/pressstart2p/v15/e3t4euO8T-267oIAQAu6jDQyK3nVivM.woff2') format('woff2');font-display:swap}
    @keyframes pulse{from{transform:scale(1);opacity:1}to{transform:scale(1.2);opacity:0.8}}
    @keyframes deathFlash{0%,100%{opacity:1}50%{opacity:0.3}}
    input{-webkit-user-select:text;user-select:text}
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
const{useState:S,useEffect:E,useCallback:C,useRef:R}=React,e=React.createElement,CS=32,TS={1:250,2:235,3:220,4:205,5:190,6:175,7:160,8:145,9:130,10:115},W=1,D=2,P=3,Y=0,
LVL=[
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,2,2,1,2,2,2,2,2,2,2,1,2,2,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,1],[1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,2,2,1,2,2,2,2,2,2,2,1,2,2,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,2,1,2,2,1,2,2,1,2,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,1,2,1,2,1,0,0,0,1,2,1,2,1,2,1],[1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,1],[1,2,1,2,1,2,1,0,0,0,1,2,1,2,1,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,2,1,2,2,1,2,2,1,2,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,2,2,1,1,1,2,2,1,2,1,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,2,2,1,2,1,0,0,0,1,2,1,2,2,2,1],[1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,1],[1,2,2,2,1,2,1,0,0,0,1,2,1,2,2,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,1,2,1,2,2,1,1,1,2,2,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'dragon',x:8,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,1,3,1,3,1,2,2,2,2,2,1],[1,2,1,1,1,2,1,2,2,2,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,2,1,1,1,2,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,3,2,2,2,2,0,0,0,0,0,2,2,2,2,3,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,2,1,1,1,2,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,2,2,2,1,2,1,1,1,2,1],[1,2,2,2,2,2,1,3,1,3,1,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7},{type:'enderman',x:7,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,2,1,1,2,1,2,1,1,2,1,1,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,2,2,2,2,2,0,0,0,0,0,2,2,2,2,2,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1],[1,2,1,1,2,1,1,2,1,2,1,1,2,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7},{type:'dragon',x:7,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,1,3,1,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,2,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,2,1,2,1,2,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,3,2,2,2,2,0,0,0,0,0,2,2,2,2,3,1],[1,1,1,2,1,2,1,0,0,0,1,2,1,2,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,2,1,2,1,2,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,2,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,1,3,1,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7},{type:'enderman',x:7,y:7},{type:'dragon',x:9,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,3,1,1,2,1,1,2,1,2,1,1,2,1,1,3,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,2,2,2,1,2,2,2,2,2,2,2,1,2,2,2,1],[1,1,1,2,1,1,1,0,0,0,1,1,1,2,1,1,1],[0,2,2,2,2,2,0,0,0,0,0,2,2,2,2,2,0],[1,1,1,2,1,1,1,0,0,0,1,1,1,2,1,1,1],[1,2,2,2,1,2,2,2,2,2,2,2,1,2,2,2,1],[1,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,3,1,1,2,1,1,2,1,2,1,1,2,1,1,3,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7},{type:'enderman',x:6,y:7},{type:'enderman',x:10,y:7},{type:'dragon',x:8,y:6}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,1,2,2,3,2,2,1,2,2,2,2,1],[1,2,1,1,2,1,2,1,1,1,2,1,2,1,1,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,2,2,1,1,2,1,2,1,2,1,1,2,2,2,1],[1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1],[1,2,2,2,1,1,1,0,0,0,1,1,1,2,2,2,1],[1,3,1,2,1,0,0,0,0,0,0,0,1,2,1,3,1],[1,2,2,2,1,1,1,0,0,0,1,1,1,2,2,2,1],[1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1],[1,2,2,2,1,1,2,1,2,1,2,1,1,2,2,2,1],[1,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,1],[1,2,1,1,2,1,2,1,1,1,2,1,2,1,1,2,1],[1,2,2,2,2,1,2,2,3,2,2,1,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'villager',x:8,y:7},{type:'enderman',x:6,y:7},{type:'enderman',x:10,y:7},{type:'dragon',x:7,y:7},{type:'dragon',x:9,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,2,1],[1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1],[1,2,1,2,1,1,2,1,2,1,2,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,2,1,0,0,0,1,2,1,1,1,1,1],[0,2,2,2,2,2,0,0,0,0,0,2,2,2,2,2,0],[1,1,1,1,1,2,1,0,0,0,1,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,2,1,2,1,2,1,1,2,1,2,1],[1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1],[1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'enderman',x:5,y:7},{type:'enderman',x:11,y:7},{type:'dragon',x:7,y:7},{type:'dragon',x:8,y:7},{type:'dragon',x:9,y:7}],start:{x:1,y:1}},
{map:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1],[1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1],[1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,2,1,0,0,0,1,2,1,1,1,1,1],[0,2,2,2,2,2,0,0,0,0,0,2,2,2,2,2,0],[1,1,1,1,1,2,1,0,0,0,1,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1],[1,3,1,2,2,2,2,2,2,2,2,2,2,2,1,3,1],[1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],enemies:[{type:'dragon',x:6,y:7},{type:'dragon',x:7,y:7},{type:'dragon',x:8,y:7},{type:'dragon',x:9,y:7},{type:'dragon',x:10,y:7}],start:{x:1,y:1}}
],MW=17,MH=15,DM=["ðŸ’€ An Enderman got you!","ðŸ‰ The Dragon strikes!","ðŸ‘¤ Villager's revenge!","ðŸ’€ You were slain!","âš¡ Too slow!","ðŸŽ® Try again!"];

function Game(){
const[cl,setCl]=S(0),[sl,setSl]=S(1),[gm,setGm]=S([]),[st,setSt]=S({x:1,y:1}),[sd,setSd]=S({x:0,y:0}),[en,setEn]=S([]),[sc,setSc]=S(0),[lv,setLv]=S(3),[go,setGo]=S(false),[gs,setGs]=S(false),[ip,setIp]=S(false),[pm,setPm]=S(false),[pt,setPt]=S(null),[mo,setMo]=S(true),[sr,setSr]=S(false),[sl2,setSl2]=S(false),[sn,setSn]=S(false),[pn,setPn]=S(''),[ps,setPs]=S(0),[wt,setWt]=S(true),[shd,setShd]=S(false),[dm,setDm]=S(''),
[lb,setLb]=S(()=>{try{return JSON.parse(localStorage.getItem('mm-lb'))||[]}catch{return[]}});
const tsR=R({x:0,y:0}),ndR=R({x:0,y:0}),sdR=R({x:0,y:0}),niR=R(null);

const chkLb=C(fs=>{if(lb.length<10||fs>(lb[lb.length-1]?.score||0)){setPs(fs);setSn(true);setTimeout(()=>niR.current?.focus(),100);return true}return false},[lb]);
const saveLb=C((n,s)=>{const ne={name:n.trim()||'Anon',score:s,date:new Date().toLocaleDateString()};const nl=[...lb,ne].sort((a,b)=>b.score-a.score).slice(0,10);setLb(nl);localStorage.setItem('mm-lb',JSON.stringify(nl));setSn(false);setPn('')},[lb]);
const initLv=C((i,rp=false)=>{const l=LVL[i];if(!rp)setGm(l.map.map(r=>[...r]));setSt({...l.start});setSd({x:0,y:0});sdR.current={x:0,y:0};ndR.current={x:0,y:0};setEn(l.enemies.map((x,j)=>({...x,sx:x.x,sy:x.y,id:j,sc:false,dir:{x:0,y:0}})));setPm(false);setWt(true);if(pt)clearTimeout(pt)},[pt]);
const startG=(l=sl)=>{setCl(l-1);setSc(0);setLv(3);setGo(false);setGs(true);setIp(false);setSr(false);setSl2(false);setShd(false);initLv(l-1)};
const startR=()=>{setWt(false);setShd(false)};
const isV=C((x,y,m)=>{if(y<0||y>=MH)return false;return m[y][(x+MW)%MW]!==W},[]);
const cntD=C(m=>m.flat().filter(c=>c===D||c===P).length,[]);
const hDir=C(d=>{if(!gs||go||ip||wt)return;ndR.current=d},[gs,go,ip,wt]);
const hTS=ev=>{if(!gs||go)return;tsR.current={x:ev.touches[0].clientX,y:ev.touches[0].clientY}};
const hTE=ev=>{if(!gs||go||ip||wt)return;const dx=ev.changedTouches[0].clientX-tsR.current.x,dy=ev.changedTouches[0].clientY-tsR.current.y;if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>30)hDir(dx>0?{x:1,y:0}:{x:-1,y:0});else if(Math.abs(dy)>30)hDir(dy>0?{x:0,y:1}:{x:0,y:-1})};

E(()=>{const onK=ev=>{if(sn)return;if(ev.key==='Enter'||ev.key===' '){ev.preventDefault();if(!gs)startG();else if(wt&&!go)startR();else if(go)startG();return}if(ev.key==='Escape'){ev.preventDefault();if(sr)setSr(false);else if(sl2)setSl2(false);else if(gs&&!go&&!wt)setIp(p=>!p);return}if((ev.key==='p'||ev.key==='P')&&gs&&!go&&!wt){ev.preventDefault();setIp(p=>!p);return}const dirs={ArrowUp:{x:0,y:-1},w:{x:0,y:-1},ArrowDown:{x:0,y:1},s:{x:0,y:1},ArrowLeft:{x:-1,y:0},a:{x:-1,y:0},ArrowRight:{x:1,y:0},d:{x:1,y:0}};if(dirs[ev.key]){ev.preventDefault();hDir(dirs[ev.key])}};window.addEventListener('keydown',onK);return()=>window.removeEventListener('keydown',onK)},[gs,go,hDir,sr,sl2,sn,wt]);

const mvEn=C((m,sp,cpm)=>{setEn(pr=>pr.map(x=>{const ds=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];const vd=ds.filter(d=>{const nx=(x.x+d.x+MW)%MW,ny=x.y+d.y;return isV(nx,ny,m)&&!(d.x===-x.dir.x&&d.y===-x.dir.y)});if(vd.length===0){const any=ds.filter(d=>isV((x.x+d.x+MW)%MW,x.y+d.y,m));if(any.length===0)return x;const d=any[Math.floor(Math.random()*any.length)];return{...x,x:(x.x+d.x+MW)%MW,y:x.y+d.y,dir:d,sc:cpm}}let ch;if(cpm){vd.sort((a,b)=>{const dA=Math.abs(x.x+a.x-sp.x)+Math.abs(x.y+a.y-sp.y),dB=Math.abs(x.x+b.x-sp.x)+Math.abs(x.y+b.y-sp.y);return dB-dA});ch=vd[0]}else{if(Math.random()<0.7){vd.sort((a,b)=>{const dA=Math.abs(x.x+a.x-sp.x)+Math.abs(x.y+a.y-sp.y),dB=Math.abs(x.x+b.x-sp.x)+Math.abs(x.y+b.y-sp.y);return dA-dB});ch=vd[0]}else ch=vd[Math.floor(Math.random()*vd.length)]}return{...x,x:(x.x+ch.x+MW)%MW,y:x.y+ch.y,dir:ch,sc:cpm}}))},[isV]);

E(()=>{if(!gs||go||ip||wt)return;const sp=TS[sl]||200;const lp=setInterval(()=>{setMo(m=>!m);setSt(pr=>{let nd=sdR.current;const tx=(pr.x+ndR.current.x+MW)%MW,ty=pr.y+ndR.current.y;if((ndR.current.x||ndR.current.y)&&isV(tx,ty,gm)){nd=ndR.current;sdR.current=nd;setSd(nd)}const nx=(pr.x+nd.x+MW)%MW,ny=pr.y+nd.y;if(!isV(nx,ny,gm))return pr;if(gm[ny][nx]===D){setGm(m=>{const nm=m.map(r=>[...r]);nm[ny][nx]=Y;return nm});setSc(s=>s+10)}if(gm[ny][nx]===P){setGm(m=>{const nm=m.map(r=>[...r]);nm[ny][nx]=Y;return nm});setSc(s=>s+50);setPm(true);if(pt)clearTimeout(pt);setPt(setTimeout(()=>setPm(false),8000))}return{x:nx,y:ny}});if(Math.random()<0.6)mvEn(gm,st,pm)},sp);return()=>clearInterval(lp)},[gs,go,ip,wt,gm,st,pm,isV,mvEn,sl,pt]);

E(()=>{if(!gs||go||wt)return;for(const x of en){if(x.x===st.x&&x.y===st.y){if(pm){setSc(s=>s+200);setEn(p=>p.map(z=>z.id===x.id?{...z,x:z.sx,y:z.sy}:z))}else{setLv(l=>{const nl=l-1;if(nl<=0){setGo(true);chkLb(sc)}else{setDm(DM[Math.floor(Math.random()*DM.length)]);setShd(true);initLv(cl,true)}return nl})}}}}if(cntD(gm)===0){const nx=cl+1;if(nx<LVL.length){setCl(nx);initLv(nx)}else{const fs=sc+1000;setGo(true);setSc(fs);chkLb(fs)}}},[st,en,gm,pm,gs,go,wt,cl,initLv,cntD,sc,chkLb]);

const rSt=()=>{const rt=sd.x===1?0:sd.x===-1?180:sd.y===1?90:sd.y===-1?-90:0;return e('div',{style:{position:'absolute',left:st.x*CS,top:st.y*CS,width:CS,height:CS,transition:'left 0.1s,top 0.1s',zIndex:10}},e('div',{style:{width:CS-4,height:CS-4,margin:2,background:'#c69c6d',border:'2px solid #8b6914',borderRadius:2,position:'relative',transform:`rotate(${rt}deg)`,boxShadow:'inset 2px 2px 0 rgba(255,255,255,0.3)'}},[e('div',{key:'h',style:{position:'absolute',top:0,left:0,right:0,height:'35%',background:'#3b2210',borderRadius:'2px 2px 0 0'}}),e('div',{key:'e1',style:{position:'absolute',top:'40%',left:'15%',width:'20%',height:'20%',background:'#fff'}},e('div',{style:{position:'absolute',right:0,top:0,width:'50%',height:'100%',background:'#4a7ebf'}})),e('div',{key:'e2',style:{position:'absolute',top:'40%',right:'15%',width:'20%',height:'20%',background:'#fff'}},e('div',{style:{position:'absolute',left:0,top:0,width:'50%',height:'100%',background:'#4a7ebf'}})),e('div',{key:'m',style:{position:'absolute',bottom:'15%',left:'30%',width:mo?'40%':'20%',height:'15%',background:'#8b6914',transition:'width 0.1s'}})]))};

const rEn=x=>{const sc=pm;const sty=x.type==='enderman'?{bg:sc?'#4444ff':'#161616',ey:sc?'#fff':'#ff00ff',ac:'#2a0a2a'}:x.type==='dragon'?{bg:sc?'#4444ff':'#1a1a2e',ey:sc?'#fff':'#ff00ff',ac:'#3d1a5c'}:{bg:sc?'#4444ff':'#8b7355',ey:sc?'#fff':'#3d5c3d',ac:'#5c4a32'};const ch=[];if(x.type==='enderman'){ch.push(e('div',{key:'a',style:{position:'absolute',top:'30%',left:'15%',width:'25%',height:'15%',background:sty.ey}}));ch.push(e('div',{key:'b',style:{position:'absolute',top:'30%',right:'15%',width:'25%',height:'15%',background:sty.ey}}))}if(x.type==='dragon'){ch.push(e('div',{key:'a',style:{position:'absolute',top:'25%',left:'10%',width:'30%',height:'25%',background:sty.ey,borderRadius:'50%'}}));ch.push(e('div',{key:'b',style:{position:'absolute',top:'25%',right:'10%',width:'30%',height:'25%',background:sty.ey,borderRadius:'50%'}}));ch.push(e('div',{key:'c',style:{position:'absolute',top:-5,left:'20%',width:5,height:7,background:'#1a1a2e',transform:'rotate(-20deg)'}}));ch.push(e('div',{key:'d',style:{position:'absolute',top:-5,right:'20%',width:5,height:7,background:'#1a1a2e',transform:'rotate(20deg)'}}))}if(x.type==='villager'){ch.push(e('div',{key:'n',style:{position:'absolute',top:'35%',left:'35%',width:'30%',height:'40%',background:'#c69c6d',borderRadius:2}}));ch.push(e('div',{key:'a',style:{position:'absolute',top:'35%',left:'15%',width:'15%',height:'15%',background:sty.ey}}));ch.push(e('div',{key:'b',style:{position:'absolute',top:'35%',right:'15%',width:'15%',height:'15%',background:sty.ey}}));ch.push(e('div',{key:'c',style:{position:'absolute',top:'25%',left:'10%',width:'25%',height:'8%',background:'#3b2210'}}));ch.push(e('div',{key:'d',style:{position:'absolute',top:'25%',right:'10%',width:'25%',height:'8%',background:'#3b2210'}}))}return e('div',{key:x.id,style:{position:'absolute',left:x.x*CS,top:x.y*CS,width:CS,height:CS,transition:'left 0.15s,top 0.15s',zIndex:5}},e('div',{style:{width:CS-4,height:CS-4,margin:2,background:sty.bg,border:`2px solid ${sty.ac}`,borderRadius:x.type==='villager'?'4px 4px 2px 2px':2,position:'relative',boxShadow:sc?'0 0 10px #00f':'none'}},ch))};

const rCell=(c,x,y)=>{const isW=c===W;const ch=[];if(c===D)ch.push(e('div',{key:'d',style:{width:8,height:8,background:'radial-gradient(circle,#50c878 0%,#228b22 100%)',borderRadius:'50%',boxShadow:'0 0 5px rgba(80,200,120,0.5)'}}));if(c===P)ch.push(e('div',{key:'p',style:{width:16,height:16,background:'radial-gradient(circle,#ffd700 0%,#daa520 100%)',borderRadius:'50%',boxShadow:'0 0 10px rgba(255,215,0,0.8)',animation:'pulse 0.5s ease-in-out infinite alternate'}}));return e('div',{key:`${x}-${y}`,style:{position:'absolute',left:x*CS,top:y*CS,width:CS,height:CS,background:isW?'linear-gradient(135deg,#1a472a 0%,#0d2818 100%)':'linear-gradient(135deg,#2d1810 0%,#1a0f0a 100%)',boxShadow:isW?'inset 2px 2px 0 rgba(255,255,255,0.1),inset -2px -2px 0 rgba(0,0,0,0.3)':'inset 1px 1px 0 rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center'}},ch)};

const CB=({dir,sym,sz=64})=>e('button',{onTouchStart:ev=>{ev.preventDefault();ev.stopPropagation();hDir(dir)},onMouseDown:ev=>{ev.preventDefault();hDir(dir)},style:{width:sz,height:sz,fontSize:sz*0.4,fontFamily:'"Press Start 2P",monospace',background:'linear-gradient(180deg,#4a6741 0%,#3d5735 50%,#2d4025 100%)',border:'4px outset #5a7a51',borderRadius:12,color:'#fff',textShadow:'2px 2px 0 #1a2a15',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',touchAction:'manipulation',userSelect:'none',outline:'none',opacity:wt?0.5:1}},sym);

const LB=({lv:l,sel,onClick})=>e('button',{onClick,style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,width:40,height:40,background:sel?'linear-gradient(180deg,#50c878 0%,#228b22 100%)':'linear-gradient(180deg,#6b7280 0%,#4b5563 100%)',border:sel?'3px solid #166534':'3px solid #374151',borderRadius:8,color:'#fff',cursor:'pointer'}},l);

return e('div',{onTouchStart:hTS,onTouchEnd:hTE,style:{minHeight:'100vh',background:'linear-gradient(180deg,#1a0a1a 0%,#2d1a2d 50%,#0d0d0d 100%)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'flex-start',padding:'10px 20px',fontFamily:'monospace',overflow:'hidden',touchAction:'manipulation'}},[
sr&&e('div',{key:'rules',style:{position:'fixed',inset:0,background:'rgba(0,0,0,0.95)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000,padding:20}},e('div',{style:{background:'linear-gradient(180deg,#2d1a2d 0%,#1a0a1a 100%)',border:'4px solid #50c878',borderRadius:16,padding:24,maxWidth:550,maxHeight:'85vh',overflow:'auto'}},[e('h2',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:14,color:'#50c878',marginBottom:16,textAlign:'center'}},'ðŸ“œ HOW TO PLAY ðŸ“œ'),e('div',{key:'c',style:{fontFamily:'"Press Start 2P",monospace',fontSize:8,color:'#fff',lineHeight:2}},'ðŸŽ¯ Collect emeralds, avoid mobs! ðŸŽ Golden Apple = Power Mode (eat mobs!) ðŸŽ® Press GO to start each round. 10 Levels with Dragons from Level 3!'),e('button',{key:'b',onClick:()=>setSr(false),style:{display:'block',margin:'16px auto 0',fontFamily:'"Press Start 2P",monospace',fontSize:11,padding:'10px 20px',background:'linear-gradient(180deg,#50c878 0%,#228b22 100%)',border:'4px solid #166534',borderRadius:8,color:'#fff',cursor:'pointer'}},'GOT IT!')])),
sl2&&e('div',{key:'lb',style:{position:'fixed',inset:0,background:'rgba(0,0,0,0.95)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000,padding:20}},e('div',{style:{background:'linear-gradient(180deg,#2d1a2d 0%,#1a0a1a 100%)',border:'4px solid #ffd700',borderRadius:16,padding:24,minWidth:320}},[e('h2',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,color:'#ffd700',marginBottom:16,textAlign:'center'}},'ðŸ† TOP 10 SCORES ðŸ†'),lb.length===0?e('p',{key:'e',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:'#888',textAlign:'center',padding:16}},'No scores yet!'):e('div',{key:'l',style:{marginBottom:16}},lb.map((x,i)=>e('div',{key:i,style:{display:'flex',justifyContent:'space-between',padding:'6px 10px',background:i===0?'rgba(255,215,0,0.2)':i===1?'rgba(192,192,192,0.2)':i===2?'rgba(205,127,50,0.2)':'transparent',borderRadius:4,marginBottom:3}},[e('span',{key:'n',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:i<3?'#ffd700':'#fff'}},`${i+1}. ${x.name}`),e('span',{key:'s',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:'#50c878'}},x.score)]))),e('button',{key:'b',onClick:()=>setSl2(false),style:{display:'block',margin:'0 auto',fontFamily:'"Press Start 2P",monospace',fontSize:11,padding:'10px 20px',background:'linear-gradient(180deg,#6b7280 0%,#4b5563 100%)',border:'4px solid #374151',borderRadius:8,color:'#fff',cursor:'pointer'}},'CLOSE')])),
sn&&e('div',{key:'ne',style:{position:'fixed',inset:0,background:'rgba(0,0,0,0.95)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000,padding:20}},e('div',{style:{background:'linear-gradient(180deg,#2d1a2d 0%,#1a0a1a 100%)',border:'4px solid #50c878',borderRadius:16,padding:24,textAlign:'center'}},[e('h2',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,color:'#ffd700',marginBottom:8}},'ðŸŽ‰ HIGH SCORE! ðŸŽ‰'),e('p',{key:'s',style:{fontFamily:'"Press Start 2P",monospace',fontSize:16,color:'#50c878',marginBottom:16}},`${ps} pts`),e('input',{key:'i',ref:niR,type:'text',value:pn,onChange:ev=>setPn(ev.target.value.slice(0,12)),onKeyDown:ev=>{if(ev.key==='Enter')saveLb(pn,ps)},placeholder:'Your name',maxLength:12,style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,padding:'10px 14px',background:'#1a0a1a',border:'3px solid #50c878',borderRadius:8,color:'#fff',textAlign:'center',width:180,marginBottom:16,outline:'none'}}),e('br',{key:'br'}),e('button',{key:'b',onClick:()=>saveLb(pn,ps),style:{fontFamily:'"Press Start 2P",monospace',fontSize:11,padding:'10px 20px',background:'linear-gradient(180deg,#50c878 0%,#228b22 100%)',border:'4px solid #166534',borderRadius:8,color:'#fff',cursor:'pointer'}},'SAVE SCORE')])),
e('div',{key:'hdr',style:{display:'flex',alignItems:'center',gap:16,marginBottom:8,flexWrap:'wrap',justifyContent:'center'}},[e('div',{key:'ttl',style:{background:'linear-gradient(180deg,#2d4025 0%,#1a2a15 100%)',border:'4px solid #0d1a08',borderRadius:8,padding:'8px 16px',boxShadow:'4px 4px 0 rgba(0,0,0,0.6)'}},e('h1',{style:{fontFamily:'"Press Start 2P",monospace',fontSize:14,color:'#50c878',textShadow:'3px 3px 0 #0d1a08',margin:0}},'â›ï¸ MINE MUNCHER â›ï¸')),e('div',{key:'sc',style:{display:'flex',gap:8,flexWrap:'wrap',justifyContent:'center'}},[e('div',{key:'s1',style:{background:'linear-gradient(180deg,#3d2817 0%,#2a1a0f 100%)',border:'3px solid #1a0f08',borderRadius:6,padding:'6px 12px'}},e('span',{style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,color:'#50c878'}},`SCORE: ${sc}`)),e('div',{key:'s2',style:{background:'linear-gradient(180deg,#3d2817 0%,#2a1a0f 100%)',border:'3px solid #1a0f08',borderRadius:6,padding:'6px 12px'}},e('span',{style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,color:'#ff6b6b'}},'â¤ï¸'.repeat(lv))),e('div',{key:'s3',style:{background:'linear-gradient(180deg,#3d2817 0%,#2a1a0f 100%)',border:'3px solid #1a0f08',borderRadius:6,padding:'6px 12px'}},e('span',{style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,color:'#4ee4fc'}},`LVL: ${cl+1}/10`))]),e('div',{key:'btns',style:{display:'flex',gap:8}},[e('button',{key:'r',onClick:()=>setSr(true),style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,padding:'8px 12px',background:'linear-gradient(180deg,#6b7280 0%,#4b5563 100%)',border:'3px solid #374151',borderRadius:6,color:'#fff',cursor:'pointer'}},'ðŸ“œ RULES'),e('button',{key:'l',onClick:()=>setSl2(true),style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,padding:'8px 12px',background:'linear-gradient(180deg,#6b7280 0%,#4b5563 100%)',border:'3px solid #374151',borderRadius:6,color:'#fff',cursor:'pointer'}},'ðŸ† SCORES')])]),
pm&&e('div',{key:'pm',style:{background:'linear-gradient(180deg,#ffd700 0%,#daa520 100%)',border:'3px solid #b8860b',borderRadius:6,padding:'6px 16px',marginBottom:6,animation:'pulse 0.3s ease-in-out infinite alternate'}},e('span',{style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,color:'#000'}},'âš¡ GOLDEN APPLE POWER! âš¡')),
e('div',{key:'ga',style:{display:'flex',flexDirection:'column',alignItems:'center'}},[e('div',{key:'bd',style:{position:'relative',width:MW*CS,height:MH*CS,border:'6px solid #1a472a',borderRadius:4,boxShadow:'0 8px 32px rgba(0,0,0,0.6),inset 0 0 30px rgba(0,0,0,0.4)',overflow:'hidden',background:'#0d0d0d'}},[...gm.flatMap((r,y)=>r.map((c,x)=>rCell(c,x,y))),...en.map(x=>rEn(x)),gs&&!go&&rSt(),
!gs&&e('div',{key:'st',style:{position:'absolute',inset:0,background:'rgba(0,0,0,0.95)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:12,padding:20}},[e('div',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:16,color:'#50c878',textShadow:'2px 2px 0 #000'}},'MINE MUNCHER'),e('div',{key:'l',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:'#aaa',marginTop:8}},'Select Starting Level'),e('div',{key:'lvs',style:{display:'flex',gap:6,flexWrap:'wrap',justifyContent:'center'}},[1,2,3,4,5,6,7,8,9,10].map(l=>e(LB,{key:l,lv:l,sel:sl===l,onClick:()=>setSl(l)}))),e('div',{key:'h',style:{fontFamily:'"Press Start 2P",monospace',fontSize:7,color:'#666'}},'1-3=Easy | 4-6=Medium | 7-10=Hard'),e('button',{key:'b',onClick:()=>startG(sl),style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,padding:'12px 24px',background:'linear-gradient(180deg,#50c878 0%,#228b22 100%)',border:'4px solid #166534',borderRadius:8,color:'#fff',cursor:'pointer',marginTop:8}},'START')]),
gs&&!go&&wt&&e('div',{key:'wt',style:{position:'absolute',inset:0,background:'rgba(0,0,0,0.85)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:15}},[shd&&e('div',{key:'dm',style:{fontFamily:'"Press Start 2P",monospace',fontSize:14,color:'#ff6b6b',textShadow:'2px 2px 0 #000',animation:'deathFlash 0.5s ease-in-out 3',marginBottom:10}},dm),e('div',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,color:'#ffd700',textShadow:'2px 2px 0 #000'}},shd?`Lives: ${'â¤ï¸'.repeat(lv)}`:`LEVEL ${cl+1}`),e('div',{key:'h',style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,color:'#aaa'}},shd?'Press GO to continue':'Get Ready!'),e('button',{key:'b',onClick:startR,style:{fontFamily:'"Press Start 2P",monospace',fontSize:14,padding:'14px 32px',background:'linear-gradient(180deg,#50c878 0%,#228b22 100%)',border:'4px solid #166534',borderRadius:8,color:'#fff',cursor:'pointer',boxShadow:'4px 4px 0 rgba(0,0,0,0.4)'}},'â–¶ GO!')]),
go&&!sn&&e('div',{key:'go',style:{position:'absolute',inset:0,background:'rgba(0,0,0,0.95)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:12}},[e('div',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:18,color:lv>0?'#50c878':'#ff6b6b',textShadow:'2px 2px 0 #000'}},lv>0?'ðŸ† YOU WIN! ðŸ†':'ðŸ’€ GAME OVER ðŸ’€'),e('div',{key:'s',style:{fontFamily:'"Press Start 2P",monospace',fontSize:14,color:'#ffd700'}},`Score: ${sc}`),e('div',{key:'l',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:'#aaa',marginTop:8}},'Select Level'),e('div',{key:'lvs',style:{display:'flex',gap:5,flexWrap:'wrap',justifyContent:'center'}},[1,2,3,4,5,6,7,8,9,10].map(l=>e(LB,{key:l,lv:l,sel:sl===l,onClick:()=>setSl(l)}))),e('button',{key:'b',onClick:()=>startG(sl),style:{fontFamily:'"Press Start 2P",monospace',fontSize:12,padding:'12px 24px',background:'linear-gradient(180deg,#50c878 0%,#228b22 100%)',border:'4px solid #166534',borderRadius:8,color:'#fff',cursor:'pointer'}},lv>0?'PLAY AGAIN':'RETRY')]),
ip&&!go&&e('div',{key:'pa',style:{position:'absolute',inset:0,background:'rgba(0,0,0,0.85)',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:15}},[e('div',{key:'t',style:{fontFamily:'"Press Start 2P",monospace',fontSize:20,color:'#ffd700',textShadow:'2px 2px 0 #000'}},'PAUSED'),e('div',{key:'h',style:{fontFamily:'"Press Start 2P",monospace',fontSize:9,color:'#aaa'}},'Press P or tap Resume')])]),
e('div',{key:'ctrl',style:{display:'flex',justifyContent:'space-between',width:MW*CS,marginTop:15,paddingLeft:10,paddingRight:10}},[e('div',{key:'lc',style:{display:'flex',gap:10,alignItems:'center'}},[e(CB,{key:'l',dir:{x:-1,y:0},sym:'â—€'}),e(CB,{key:'r',dir:{x:1,y:0},sym:'â–¶'})]),gs&&!go&&!wt&&e('button',{key:'pa',onClick:()=>setIp(p=>!p),style:{fontFamily:'"Press Start 2P",monospace',fontSize:10,padding:'10px 20px',background:'linear-gradient(180deg,#6b7280 0%,#4b5563 100%)',border:'3px solid #374151',borderRadius:6,color:'#fff',cursor:'pointer',alignSelf:'center'}},ip?'RESUME':'PAUSE'),e('div',{key:'rc',style:{display:'flex',gap:10,alignItems:'center'}},[e(CB,{key:'u',dir:{x:0,y:-1},sym:'â–²'}),e(CB,{key:'d',dir:{x:0,y:1},sym:'â–¼'})])])])
])}
ReactDOM.createRoot(document.getElementById('root')).render(e(Game));
if('serviceWorker'in navigator)window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));
  </script>
</body>
</html>
